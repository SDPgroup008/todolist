{% extends 'base.html' %}

{% block content %}
    <h1>My To-Do List</h1>
    <link rel="stylesheet" href="{% static 'tasks.css' %}">

    <a href="{% url 'tasks:add_task' %}">Add Task</a>
    
    <h2>New Tasks</h2>
    {% for task in tasks %}
        {% if not task.completed %}
            <div class="task-item">
                <input type="checkbox" id="task-{{ task.id }}-checkbox" {% if task.completed %}checked{% endif %} onchange="toggleTaskCompletion({{ task.id }})">
                <strong>{{ task.title }}</strong>
                <button class="edit-button" onclick="location.href='{% url 'tasks:edit_task' task.id %}'">Edit</button>
                <button class="delete-button" onclick="location.href='{% url 'tasks:delete_task' task.id %}'">Delete</button>
                <p>{{ task.description }}</p>
            </div>
        {% endif %}
    {% endfor %}

    <h2>Completed Tasks</h2>
    {% for task in tasks %}
        {% if task.completed %}
            <div class="task-item">
                <input type="checkbox" id="task-{{ task.id }}-checkbox" checked onchange="toggleTaskCompletion({{ task.id }})">
                <strong>{{ task.title }}</strong>
                <button class="edit-button" onclick="location.href='{% url 'tasks:edit_task' task.id %}'">Edit</button>
                <button class="delete-button" onclick="location.href='{% url 'tasks:delete_task' task.id %}'">Delete</button>
                <p>{{ task.description }}</p>
            </div>
        {% endif %}
    {% endfor %}

    <script>
        function toggleTaskCompletion(taskId) {
            const checkbox = document.getElementById(`task-${taskId}-checkbox`);
            const completed = checkbox.checked;

            // Send an AJAX request to update the task completion status
            // You can use JavaScript fetch or any other AJAX library/framework

            // Example using fetch:
            fetch(`/api/tasks/${taskId}/`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ completed }),
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response or update the UI accordingly
                console.log(data);
            })
            .catch(error => {
                // Handle errors
                console.error(error);
            });
        }
    </script>
{% endblock %}
